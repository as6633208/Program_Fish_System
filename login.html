<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>水產養殖管理系統</title>
    <meta name="description" content="智慧水產養殖管理資訊系統" />
    <meta name="keywords" content="智慧水產養殖管理資訊系統" />
    <meta name="author" content="智慧水產養殖管理資訊系統" />
    <!-- Icon -->
    <link rel="icon" href="image/favcon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="image/favcon.ico">
    <!-- CSS Design -->
    <link href="css/jasny-bootstrap.min.css" rel="stylesheet" />
    <!-- CSS Main -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- ================== CSS notify樣式 ================== -->
    <link href="css/notify/notyf.min.css" rel="stylesheet" />
    <!-- ================== CSS sweetalert2 ================== -->
    <link href="css/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <!--驗證結果訊息為了美觀，多追加以下的css-->
    <style type="text/css">
        #span_result {
            color: Red;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!--Loding-->
    <div class="preloader-it">
        <div class="la-anim-1"></div>
    </div>
    <!--Loding-->
    <div class="wrapper pa-0">
        <!--Main-->
        <div class="page-wrapper pa-0 ma-0">
            <div class="container-fluid full">
                <!-- Row -->
                <div class="table-struct full-width full-height">
                    <div class="table-cell vertical-align-middle">
                        <div class="auth-form  ml-auto mr-auto no-float">
                            <div class="panel panel-default card-view mb-0">
                                <div class="panel-heading">
                                    <div class="pull-right">
                                        <h4> 登入系統 </h4>
                                        <p style="color:red;">請直接登入您的帳號、密碼與驗證碼</p>
                                    </div>
                                    <img src="image/icon/login.png" height="50" width="50" />
                                    <div class="clearfix"></div>
                                </div>
                                <div class="panel-wrapper collapse in">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-sm-12 col-xs-12">
                                                <div class="form-wrap">
                                                    <form action="#"  id="form1">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-3">帳號</label>
                                                            <div class="input-group">
                                                                <input type="text" class="form-control" required="" id="login_account" placeholder="輸入帳號">
                                                                <div class="input-group-addon"><i class="icon-envelope-open"></i></div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="control-label col-md-3">密碼</label>
                                                            <div class="input-group">
                                                                <input type="password" class="form-control" required="" id="login_password" placeholder="輸入密碼">
                                                                <div class="input-group-addon"><i class="icon-lock"></i></div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">驗證碼</label>
                                                        <div class="input-group">
                                                                <input type="text" class="form-control" required="" id="txt_input" maxlength="4" placeholder="輸入驗證碼">
                                                                <div class="input-group-addon"><img src="ValidateNumber.ashx" alt="驗證碼" onclick="form1.imgCode.src='ValidateNumber.ashx?' + Math.random();" name="imgCode" /> </div>                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <input type="submit" class="btn btn-primary btn-block" value="登入" />
                                                            <img src="image/background/logo-1.png" />
                                                         </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Row -->
            </div>
            <!-- Footer -->
            <footer class="footer">
                <div class="row">
                    <div class="col-sm-12 text-center" style="color:black">
                        <p>&nbsp;&nbsp;國立屏東科技大學 電子商務研發中心、資訊管理系多媒體資訊網路前瞻實驗室 版權所有&nbsp;&nbsp;&nbsp;&nbsp; Copyright &copy; 2017 &nbsp; All Rights Reserved &nbsp;&nbsp;本網站支援IE10以上、Firefox及Chrome，最佳瀏覽解析度為1024x768以上</p>
                    </div>
                </div>
            </footer>
            <!-- /Footer -->
        </div>
        <!--Main-->
    </div>
    <!-- jQuery -->
    <script src="javascript/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="javascript/bootstrap.min.js"></script>
    <script src="javascript/jasny-bootstrap.min.js"></script>
    <!-- Slimscroll JavaScript -->
    <script src="javascript/jquery.slimscroll.js"></script>
    <!-- Fancy Dropdown JS -->
    <script src="javascript/dropdown-bootstrap-extended.js"></script>
    <!-- Init -->
    <script src="javascript/init.js"></script>
    <script src="javascript/typed.js"></script>
    <!-- ================== JS notify控制 ================== -->
    <script src="javascript/notify/notyf.min.js"></script>
    <!-- ================== JS cookie ================== -->
    <script src="javascript/cookie/js.cookie-2.1.3.min.js"></script>
    <!-- ================== JS sweetalert2 ================== -->
    <script src="javascript/sweetalert2/sweetalert2.min.js"></script>
    <script type="text/javascript">
        var notyf = new Notyf();//notyf.js宣告使用
        jQuery(document).ready(init);
        function init() {
           /*每次Dom載入完，確保圖片都不一樣*/
            jQuery("img[name='imgCode']").attr("src", "ValidateNumber.ashx?" + Math.random());
        }//validate_val
        function isPassValidateCode() {
              var  nowValidateNumber =  jQuery.ajax({
                url: "verification.ashx",
                type: "post",
                async: false,
                data:{},
                success: function (htmlVal) {  }
            }).responseText;
            if (nowValidateNumber == "" || nowValidateNumber == null) {
                alert("驗證碼逾時，請重新整理");
                return false;
            }
            var userInput = $("#txt_input").val();//txt_input
            var validateResult = ((nowValidateNumber == userInput) ? true : false);
            if (validateResult == false) {
                jQuery("#span_result").html("驗證碼輸入不正確");
                notyf.alert('輸入錯誤，登入失敗');
            } 
            //回傳true Or false
            return validateResult;
        }
        $(document).ready(function () {
            $("#form1").submit(function (e) {
                e.preventDefault();
                if (isPassValidateCode()) {//驗證成功                   
                    $.ajax({
                        type: 'post',
                        url: 'database/login.ashx',
                        dataType: 'json',
                        async: false,
                        data: {
                            username: $("#login_account").val(),
                            password: $("#login_password").val()
                        },
                        success: function (e) {
                            if (Number(e) > 0) {
                                swal({
                                    type: 'success',
                                    title: '登入成功!',
                                    allowOutsideClick: false //不可點背景關閉
                                }).then(function () {
                                    location.href = 'blank.html';
                                })
                            } else {
                                notyf.alert('輸入錯誤，登入失敗');
                            }
                            Cookies.set('user', "login_admin", { expires: 1 });//設置cookie一天時間
                        },
                        error: function (e) {
                            notyf.alert('伺服器錯誤,無法載入');
                        }
                    });
                }
               
            });
        });
    </script>
</body>
</html>
