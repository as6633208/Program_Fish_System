var notyf = new Notyf();//notyf.js宣告使用
jQuery(document).ready(init);
function init() {
   /*每次Dom載入完，確保圖片都不一樣*/
    jQuery("img[name='imgCode']").attr("src", "ValidateNumber.ashx?" + Math.random());
}//validate_val
function isPassValidateCode() {
      var  nowValidateNumber =  jQuery.ajax({
        url: "verification.ashx",
        type: "post",
        async: false,
        data:{},
        success: function (htmlVal) {  }
    }).responseText;
    if (nowValidateNumber == "" || nowValidateNumber == null) {
        alert("驗證碼逾時，請重新整理");
        return false;
    }
    var userInput = $("#txt_input").val();//txt_input
    var validateResult = ((nowValidateNumber == userInput) ? true : false);
    if (validateResult == false) {
        jQuery("#span_result").html("驗證碼輸入不正確");
        notyf.alert('輸入錯誤，登入失敗');
    }
    //回傳true Or false
    return validateResult;
}
$(document).ready(function () {
    $("#form1").submit(function (e) {
        e.preventDefault();
        if (isPassValidateCode()) {//驗證成功
            $.ajax({
                type: 'post',
                url: 'database/login.ashx',
                dataType: 'json',
                async: false,
                data: {
                    username: $("#login_account").val(),
                    password: $("#login_password").val()
                },
                success: function (e) {
                    if (e.length > 0) {
                        swal({
                            type: 'success',
                            title: '登入成功!',
                            allowOutsideClick: false //不可點背景關閉
                        }).then(function () {
                            location.href = 'blank.html';
                        })
                    } else {
                        notyf.alert('輸入錯誤，登入失敗');
                    }
                    Cookies.set('user', e[0].Account, { expires: 1 });//設置cookie一天時間
                    Cookies.set('authority', e[0].authority, { expires: 1 });//設置cookie一天時間
                },
                error: function (e) {
                    notyf.alert('伺服器錯誤,無法載入');
                }
            });
        }

    });
});